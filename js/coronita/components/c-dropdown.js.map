{"version":3,"sources":["coronita/components/c-dropdown.js"],"names":["Coronita","clientflow","cDropdown","KEY_INTRO","KEY_SPACE","KEY_UP","KEY_DOWN","KEY_TAB","KEY_ESC","KEY_HOME","KEY_END","CLASS_EXPANDED","ATTRIBUTE_EXPANDED","SELECTOR_C_DROPDOWN_CONTROLLER","SELECTOR_C_DROPDOWN_CONTENT_ITEMS","EVENTS_POINTER","EVENTS_CONTENT_EXPANDED","EVENTS_BUTTON","CLICK_KEYS","BOOLEAN_ADD_LISTENER","BOOLEAN_REMOVE_LISTENER","userData","data","closeList","$refs","classList","remove","controller","setAttribute","removeAttribute","forEach","event","content","removeEventListener","operateList","mouseEventsListener","focusFirst","contentItems","focus","focusLast","length","isClick","ev","type","indexOf","keyCode","addListener","addFocusoutEvent","addEventListener","removeFocusoutEvent","mouseEvents","shiftKey","preventDefault","currentTarget","previousElementSibling","nextElementSibling","click","toggleList","isExpanded","getAttribute","add","item","init","document","getElementById","id","cDropdownController","querySelector","Array","prototype","slice","call","querySelectorAll","ui","$","each","attr","split"],"mappings":"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","sourcesContent":["// COMPONENT - c-input-box\nCoronita.clientflow.cDropdown = (function () {\n  const KEY_INTRO = 13;\n  const KEY_SPACE = 32;\n  const KEY_UP = 38;\n  const KEY_DOWN = 40;\n  const KEY_TAB = 9;\n  const KEY_ESC = 27;\n  const KEY_HOME = 36;\n  const KEY_END = 35;\n  const CLASS_EXPANDED = 'is-expanded';\n  const ATTRIBUTE_EXPANDED = 'data-coronita-c-dropdown-expanded';\n  const SELECTOR_C_DROPDOWN_CONTROLLER = '[data-coronita-c-dropdown-expanded]';\n  const SELECTOR_C_DROPDOWN_CONTENT_ITEMS = '[role=\"menuitem\"]';\n  const EVENTS_POINTER = ['mouseover', 'mouseout', 'focus'];\n  const EVENTS_CONTENT_EXPANDED = ['keydown'];\n  const EVENTS_BUTTON = ['click', 'keydown'];\n  const CLICK_KEYS = [KEY_INTRO, KEY_SPACE, KEY_DOWN, KEY_UP];\n  const BOOLEAN_ADD_LISTENER = true;\n  const BOOLEAN_REMOVE_LISTENER = false;\n  return function (userData) {\n    let data = {};\n\n    function closeList () {\n      data.$refs.cDropdown.classList.remove(CLASS_EXPANDED);\n      data.$refs.controller.setAttribute(ATTRIBUTE_EXPANDED, 'false');\n      data.$refs.controller.removeAttribute('aria-expanded');\n      EVENTS_CONTENT_EXPANDED.forEach(event => {\n        data.$refs.content.removeEventListener(event, operateList);\n      });\n      mouseEventsListener(BOOLEAN_REMOVE_LISTENER);\n    }\n\n    function focusFirst () {\n      data.$refs.contentItems[0].focus();\n    }\n\n    function focusLast () {\n      data.$refs.contentItems[data.$refs.contentItems.length - 1].focus();\n    }\n\n    function isClick (ev) {\n      return ev.type === 'click' || CLICK_KEYS.indexOf(ev.keyCode) !== -1;\n    }\n\n    function mouseEventsListener (addListener) {\n      function addFocusoutEvent () {\n        data.$refs.content.addEventListener('focusout', closeList);\n      }\n\n      function removeFocusoutEvent () {\n        data.$refs.content.removeEventListener('focusout', closeList);\n      }\n\n      function mouseEvents (ev) {\n        if (ev.type === 'mouseover' || ev.type === 'focus') {\n          removeFocusoutEvent();\n        } else {\n          addFocusoutEvent();\n        }\n      }\n\n      if (addListener) {\n        addFocusoutEvent();\n      }\n\n      EVENTS_POINTER.forEach(function (event) {\n        if (addListener) {\n          data.$refs.content.addEventListener(event, mouseEvents);\n        } else {\n          removeFocusoutEvent();\n          data.$refs.content.removeEventListener(event, mouseEvents);\n        }\n      });\n    }\n\n    function operateList (ev) {\n      mouseEventsListener(BOOLEAN_REMOVE_LISTENER);\n      if (ev.keyCode === KEY_UP || (ev.keyCode === KEY_TAB && ev.shiftKey)) {\n        ev.preventDefault();\n        if (ev.currentTarget.previousElementSibling) {\n          ev.currentTarget.previousElementSibling.focus();\n        } else {\n          focusLast();\n        }\n      } else if (ev.keyCode === KEY_DOWN || ev.keyCode === KEY_TAB) {\n        ev.preventDefault();\n        if (ev.currentTarget.nextElementSibling) {\n          ev.currentTarget.nextElementSibling.focus();\n        } else {\n          focusFirst();\n        }\n      } else if (ev.keyCode === KEY_ESC) {\n        ev.preventDefault();\n        closeList();\n        data.$refs.controller.focus();\n      } else if (ev.keyCode === KEY_HOME) {\n        ev.preventDefault();\n        focusFirst();\n      } else if (ev.keyCode === KEY_END) {\n        ev.preventDefault();\n        focusLast();\n      } else if (ev.keyCode === KEY_INTRO || ev.keyCode === KEY_SPACE) {\n        ev.preventDefault();\n        ev.currentTarget.click();\n      }\n      mouseEventsListener(BOOLEAN_ADD_LISTENER);\n    }\n\n    function toggleList (ev) {\n      if (isClick(ev)) {\n        ev.preventDefault();\n        const isExpanded = data.$refs.controller.getAttribute(ATTRIBUTE_EXPANDED) === 'true';\n        if (!isExpanded) {\n          data.$refs.controller.setAttribute(ATTRIBUTE_EXPANDED, 'true');\n          data.$refs.controller.setAttribute('aria-expanded', 'true');\n          data.$refs.cDropdown.classList.add(CLASS_EXPANDED);\n\n          if (ev.keyCode === KEY_UP) {\n            focusLast();\n          } else {\n            focusFirst();\n          }\n\n          EVENTS_CONTENT_EXPANDED.forEach(event => {\n            data.$refs.contentItems.forEach(item => {\n              item.addEventListener(event, operateList);\n            });\n          });\n          mouseEventsListener(BOOLEAN_ADD_LISTENER);\n        } else {\n          closeList();\n        }\n      }\n    }\n\n    /**\n     * init method\n     * Call template mixin '_.c_coronita_c_dropdown()' (c_coronita_c_dropdown.tmpl.html) in the html file\n     * Call init in *.mvc.js, for example in 'afterRender' method:\n     * uiCoronitaComponentsDropdown.init(this.$el);\n     * @param $idViewContainer - jquery object container element selector\n     * @public\n     */\n    function init () {\n      const cDropdown = document.getElementById('c-dropdown-' + userData.id);\n      const cDropdownController = cDropdown.querySelector(SELECTOR_C_DROPDOWN_CONTROLLER);\n      data.$refs = {\n        cDropdown: cDropdown,\n        controller: cDropdownController,\n        content: document.getElementById(cDropdownController.getAttribute('aria-controls')),\n        contentItems: Array.prototype.slice.call(cDropdown.querySelectorAll(SELECTOR_C_DROPDOWN_CONTENT_ITEMS))\n      };\n\n      EVENTS_BUTTON.forEach(event => {\n        data.$refs.controller.addEventListener(event, toggleList);\n      });\n    }\n\n    return {\n      init\n    };\n  };\n})();\n\nCoronita.ui.cDropdown = (function () {\n  function init () {\n    $('[data-coronita-c-dropdown]').each(function () {\n      let cDropdown = new Coronita.clientflow.cDropdown({\n        id: $(this).attr('id').split('c-dropdown-')[1]\n      });\n      cDropdown.init();\n    });\n  }\n\n  return {\n    init\n  };\n})();\n"],"file":"c-dropdown.js"}
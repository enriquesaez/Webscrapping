{"version":3,"sources":["coronita/components/c-input-predictive.js"],"names":["Coronita","clientflow","cInputPredictive","SELECTOR_HIGHTLIGHTED_TEMPLATE","SELECTOR_LISTBOX_TEMPLATE","DEFAULT_PREDICION_TYPE","DEFAULT_PREDICION_TIMEOUT","DEFAULT_PREDICION_MIN_LENGTH","DEFAULT_PREDICION_EVENT","KEY_ARROW_UP","KEY_ARROW_DOWN","KEY_ESC","KEY_TAB","KEY_ENTER","ATTR_DATA_LAST_VALUE","MOUSE_EVENTS_LISTENER_ADD","MOUSE_EVENTS_LISTENER_REMOVE","userData","data","emptyResults","block","emptyResultsBlock","listbox","emptyResultsListbox","fillResults","fillResultsBlock","fillResultsListbox","clickOptionListbox","ev","prediction","type","selectOption","currentTarget","document","getElementById","resultsTargetId","innerHTML","$refs","input","setAttribute","removeAttribute","removeResultsListbox","results","uiCoronitaComponentsListbox","mouseEventsListener","removeEventListener","operateListbox","insertAdjacentHTML","_","tmpl","resultsTemplateId","options","id","inputValue","parsedResults","highlightResults","moveResults","setPosition","isLabelOver","style","display","addEventListener","Array","from","children","forEach","option","updatedResults","$","extend","getExtendedData","minLength","timeout","action","noop","event","getResults","Promise","resolve","then","response","length","ignoredKeys","indexOf","keyCode","onInputEvent","value","getAttribute","clearTimeout","setTimeout","isExpanded","evIsClick","$list","$activeOptionAria","querySelector","$activeOption","$activeOptionPrev","previousElementSibling","$activeOptionNext","nextElementSibling","preventDefault","offsetTop","scrollTop","prototype","filter","call","parentNode","child","checkActiveDescendant","triggerInputChange","focus","publish","name","init","search","ui","each","attr","split","content","selected"],"mappings":"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","sourcesContent":["// COMPONENT - c-input-predictive\nCoronita.clientflow.cInputPredictive = (function () {\n  const SELECTOR_HIGHTLIGHTED_TEMPLATE = '#c-coronita-c-input-predictive-listbox-hightlighted';\n  const SELECTOR_LISTBOX_TEMPLATE = '#c-coronita-c-input-predictive-listbox';\n  const DEFAULT_PREDICION_TYPE = 'listbox';\n  const DEFAULT_PREDICION_TIMEOUT = 200;\n  const DEFAULT_PREDICION_MIN_LENGTH = 3;\n  const DEFAULT_PREDICION_EVENT = 'keyup';\n  const KEY_ARROW_UP = 38;\n  const KEY_ARROW_DOWN = 40;\n  const KEY_ESC = 27;\n  const KEY_TAB = 9;\n  const KEY_ENTER = 13;\n  const ATTR_DATA_LAST_VALUE = 'data-coronita-c-input-predictive-last-value';\n  const MOUSE_EVENTS_LISTENER_ADD = true;\n  const MOUSE_EVENTS_LISTENER_REMOVE = false;\n\n  return function (userData) {\n    let data = {};\n    const emptyResults = {\n      block: emptyResultsBlock,\n      listbox: emptyResultsListbox\n    };\n    const fillResults = {\n      block: fillResultsBlock,\n      listbox: fillResultsListbox\n    };\n\n    function clickOptionListbox (ev) {\n      emptyResults[data.prediction.type]();\n      selectOption(ev.currentTarget);\n    }\n\n    function emptyResultsBlock () {\n      document.getElementById(userData.resultsTargetId).innerHTML = '';\n      data.$refs.input.setAttribute('aria-expanded', 'false');\n      data.$refs.input.removeAttribute(ATTR_DATA_LAST_VALUE);\n      data.$refs.input.removeAttribute('aria-activedescendant');\n    }\n\n    function emptyResultsListbox () {\n      removeResultsListbox();\n      if (data.$refs.results) {\n        uiCoronitaComponentsListbox.mouseEventsListener(MOUSE_EVENTS_LISTENER_REMOVE, data.$refs.results, data.$refs.input, emptyResultsListbox);\n      }\n      data.$refs.input.removeEventListener('keydown', operateListbox);\n      data.$refs.input.removeEventListener('click', operateListbox);\n      data.$refs.input.setAttribute('aria-expanded', 'false');\n      data.$refs.input.removeAttribute(ATTR_DATA_LAST_VALUE);\n      data.$refs.input.removeAttribute('aria-activedescendant');\n    }\n\n    function fillResultsBlock (results) {\n      emptyResultsBlock();\n      document.getElementById(userData.resultsTargetId)\n        .insertAdjacentHTML('beforeend', _.tmpl('#' + userData.resultsTemplateId, {\n          options: results,\n          id: userData.id\n        }));\n    }\n\n    function fillResultsListbox (results, inputValue) {\n      const parsedResults = highlightResults(results, inputValue);\n      removeResultsListbox();\n      //data.$refs.results = uiCoronitaComponentsListbox.appendResults(SELECTOR_LISTBOX_TEMPLATE, parsedResults, userData.id);\n      data.$refs.results = uiCoronitaComponentsListbox.moveResults(userData.id);\n      uiCoronitaComponentsListbox.setPosition(data.$refs.results, data.$refs.cInputPredictive, userData.isLabelOver);\n      data.$refs.results.style.display = 'block';\n      data.$refs.input.setAttribute('aria-expanded', 'true');\n      data.$refs.input.addEventListener('keydown', operateListbox);\n      data.$refs.input.addEventListener('click', operateListbox);\n\n      Array.from(data.$refs.results.children).forEach(option => {\n        option.addEventListener('click', clickOptionListbox);\n      });\n\n      uiCoronitaComponentsListbox.mouseEventsListener(MOUSE_EVENTS_LISTENER_ADD, data.$refs.results, data.$refs.input, emptyResultsListbox);\n    }\n\n    function highlightResults (results, inputValue) {\n      var updatedResults = $.extend(true, [], results);\n      /*updatedResults.map(function (result) {\n        result.contentHightlighted = result.content.replace(inputValue, document.createRange().createContextualFragment(`<span class=\"c-input-predictive__mark\">{$inputValue}</span>`)).replace(/^\\s+|\\s+$/g, '');\n        result.contentHightlighted = result.content;\n        return result;\n      });*/\n      return updatedResults;\n    }\n\n    function getExtendedData () {\n      const minLength = userData.prediction.minLength;\n      data.prediction = {\n        type: userData.prediction.type || DEFAULT_PREDICION_TYPE,\n        timeout: userData.prediction.timeout || DEFAULT_PREDICION_TIMEOUT,\n        minLength: (minLength || minLength === 0) ? minLength : DEFAULT_PREDICION_MIN_LENGTH,\n        action: userData.prediction.action || _.noop,\n        event: userData.prediction.event || DEFAULT_PREDICION_EVENT\n      };\n    }\n\n    function getResults (inputValue) {\n      const results = Promise.resolve(data.prediction.action(inputValue));\n      results.then(response => {\n        if (response && response.length > 0) {\n          fillResults[data.prediction.type](response, inputValue);\n        } else {\n          emptyResults[data.prediction.type]();\n        }\n      });\n    }\n\n    function ignoredKeys (ev) {\n      return [KEY_ARROW_UP, KEY_ARROW_DOWN, KEY_ESC, KEY_TAB, KEY_ENTER].indexOf(ev.keyCode) !== -1;\n    }\n\n    function onInputEvent (ev) {\n      if (!ignoredKeys(ev)) {\n        let timeout;\n        let inputValue = ev.currentTarget.value;\n        if (inputValue !== data.$refs.input.getAttribute(ATTR_DATA_LAST_VALUE)) {\n          if (timeout) {\n            clearTimeout(timeout);\n          }\n          timeout = setTimeout(function () {\n            data.$refs.input.setAttribute(ATTR_DATA_LAST_VALUE, inputValue);\n            if (inputValue.length >= data.prediction.minLength) {\n              getResults(inputValue);\n            } else {\n              emptyResults[data.prediction.type](data);\n            }\n          }, data.prediction.timeout);\n        }\n      }\n    }\n\n    function operateListbox (ev) {\n      const isExpanded = ev.currentTarget.getAttribute('aria-expanded') === 'true';\n      const evIsClick = ev.keyCode === KEY_ENTER || ev.type === 'click';\n      const $list = data.$refs.results;\n      const $activeOptionAria = $list.querySelector('[aria-selected=\"true\"]');\n      const $activeOption = $activeOptionAria || $list.children[0];\n      const $activeOptionPrev = $activeOption.previousElementSibling;\n      const $activeOptionNext = $activeOption.nextElementSibling;\n\n      if (isExpanded && (evIsClick || ev.keyCode === KEY_ESC || ev.keyCode === KEY_TAB)) {\n        emptyResults[data.prediction.type]();\n      } else if (isExpanded && ev.keyCode === KEY_ARROW_UP) {\n        ev.preventDefault();\n        if ($activeOptionPrev) {\n          if ($activeOptionPrev.offsetTop < 0) {\n            $list.scrollTop = $activeOptionPrev.offsetTop;\n          }\n          selectOption($activeOptionPrev);\n        }\n      } else if (isExpanded && ev.keyCode === KEY_ARROW_DOWN) {\n        ev.preventDefault();\n        if ($activeOptionNext) {\n          if ($activeOptionNext.offsetTop > $list.scrollTop) {\n            $list.scrollTop = $activeOptionNext.offsetTop;\n          }\n          selectOption($activeOptionNext);\n        }\n      }\n    }\n\n    function removeResultsListbox () {\n      data.$refs.results = uiCoronitaComponentsListbox.moveResults(userData.id, data.$refs.cInputPredictive);\n      //uiCoronitaComponentsListbox.removeResults(userData.id);\n    }\n\n    function selectOption ($activeOption) {\n      if ($activeOption) {\n        Array.prototype.filter.call(Array.from($activeOption.parentNode.children), function (child) {\n          child.setAttribute('aria-selected', child === $activeOption);\n        });\n        data.$refs.input.value = $activeOption.getAttribute('data-value');\n        uiCoronitaComponentsListbox.checkActiveDescendant(data.$refs.input, data.$refs.results);\n        uiCoronitaComponentsListbox.triggerInputChange(data.$refs.input);\n        data.$refs.input.focus();\n        $.publish('coronita:component:predictive', {\n          value: data.$refs.input.value,\n          name: data.$refs.input.getAttribute('name')\n        });\n      }\n    }\n\n    /**\n     * init method\n     * Call template mixin '_.c_coronita_c_input_predictive()' (c_coronita_c_input_predictive.tmpl.html) in the html file\n     *\n     * @public\n     */\n    /*****************************/\n    function init () {\n      getExtendedData(userData);\n      const cInputPredictive = document.getElementById('c-input-predictive-' + userData.id);\n      data.$refs = {\n        cInputPredictive: cInputPredictive,\n        input: cInputPredictive.querySelector('input'),\n        results: null\n      };\n      data.$refs.input.addEventListener(data.prediction.event, onInputEvent);\n    }\n\n    return {\n      init,\n      search: getResults\n    };\n  };\n})();\n\nCoronita.ui.cInputPredictive = (function () {\n  function init () {\n    $('[data-coronita-c-input=\"predictive\"]').each(function () {\n      var cInputPredictive = new Coronita.clientflow.cInputPredictive({\n        id: $(this).attr('id').split('c-input-predictive-')[1],\n        prediction: {\n          minLength: 3,\n          action: function () {\n            return [\n              { content: 'Fondo 1', selected: false },\n              { content: 'Fondo 2' },\n              { content: 'Fondo 3' },\n              { content: 'Lorem ipsum dolor sit' },\n              { content: 'Fondo 4', selected: true },\n              { content: 'Fondo 5' }\n            ];\n          }\n        }\n      });\n      cInputPredictive.init();\n    });\n  }\n\n  return {\n    init\n  };\n})();\n"],"file":"c-input-predictive.js"}
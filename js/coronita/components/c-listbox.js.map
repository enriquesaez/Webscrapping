{"version":3,"sources":["coronita/components/c-listbox.js"],"names":["uiCoronitaModulesValidation","init","Coronita","clientflow","cListbox","LISTBOX_MOUSE_EVENTS","LISTBOX_ID_PREFIX","SELECTOR_LISTBOX_WRAPPER","KEY_ARROW_DOWN","KEY_ARROW_UP","KEY_ESC","KEY_TAB","KEY_ENTER","KEY_SPACE","KEYS_LISTBOX_LOCK_TAB_NAVIGATION","KEYS_LISTBOX","appendResults","templateId","results","id","target","document","body","insertAdjacentHTML","_","tmpl","options","getElementById","checkActiveDescendant","$parent","$listbox","$selected","querySelector","setAttribute","getAttribute","getActiveOption","data","selectedOption","uiCoronitaComponentsListbox","setAriaSelected","$refs","listbox","getListboxKeys","cSelect","listboxKeyDown","ev","callback","includes","keyCode","preventDefault","listboxKeyDownArrowUp","listboxKeyDownArrowDown","closeListbox","$activeOptionNext","currentActiveOption","nextElementSibling","children","offsetTop","offsetHeight","scrollTop","selectOption","$activeOptionPrev","previousElementSibling","mouseEventsListener","addListener","$secondary","$focusable","addFocusoutEvent","addEventListener","removeFocusoutEvent","removeEventListener","mouseEvents","type","forEach","event","moveResults","LISTBOX_ID","appendChild","removeResults","parentNode","removeChild","$activeOption","$previousSelectedOption","setPosition","$listboxOwner","$listboxOwnerWrapper","style","position","zIndex","width","offsetWidth","left","getBoundingClientRect","window","pageXOffset","top","pageYOffset","triggerInputChange","input","createEvent","initEvent","dispatchEvent"],"mappings":"AAAA;AAEAA,2BAA2B,GAAG;AAC5BC,EAAAA,IAAI,EAAE,gBAAY;AAChB,WAAO,IAAP;AACD;AAH2B,CAA9B;;AAMAC,QAAQ,CAACC,UAAT,CAAoBC,QAApB,GAAgC,YAAY;AAC1C,MAAMC,oBAAoB,GAAG,CAAC,WAAD,EAAc,UAAd,EAA0B,OAA1B,CAA7B;AACA,MAAMC,iBAAiB,GAAG,YAA1B;AACA,MAAMC,wBAAwB,GAAG,iCAAjC;AACA,MAAMC,cAAc,GAAG,EAAvB;AACA,MAAMC,YAAY,GAAG,EAArB;AACA,MAAMC,OAAO,GAAG,EAAhB;AACA,MAAMC,OAAO,GAAG,CAAhB;AACA,MAAMC,SAAS,GAAG,EAAlB;AACA,MAAMC,SAAS,GAAG,EAAlB;AACA,MAAMC,gCAAgC,GAAG,CACvCL,YADuC,EAEvCD,cAFuC,EAGvCG,OAHuC,EAIvCD,OAJuC,EAKvCE,SALuC,EAMvCC,SANuC,CAAzC;AAQA,MAAME,YAAY,GAAG,CAACN,YAAD,EAAeD,cAAf,CAArB;;AAEA,WAASQ,aAAT,CAAuBC,UAAvB,EAAmCC,OAAnC,EAA4CC,EAA5C,EAAgDC,MAAhD,EAAwD;AACtD,KAACA,MAAM,IAAIC,QAAQ,CAACC,IAApB,EAA0BC,kBAA1B,CACE,WADF,EAEEC,CAAC,CAACC,IAAF,CAAOR,UAAP,EAAmB;AACjBS,MAAAA,OAAO,EAAER,OADQ;AAEjBC,MAAAA,EAAE,EAAEA;AAFa,KAAnB,CAFF;AAOA,WAAOE,QAAQ,CAACM,cAAT,WAA2BrB,iBAA3B,SAA+Ca,EAA/C,EAAP;AACD;;AAED,WAASS,qBAAT,CAA+BC,OAA/B,EAAwCC,QAAxC,EAAkD;AAChD,QAAMC,SAAS,GAAGD,QAAQ,CAACE,aAAT,CAAuB,wBAAvB,CAAlB;;AACA,QAAID,SAAJ,EAAe;AACbF,MAAAA,OAAO,CAACI,YAAR,CAAqB,uBAArB,EAA8CF,SAAS,CAACG,YAAV,CAAuB,IAAvB,CAA9C;AACD;AACF;;AAED,WAASC,eAAT,CAAyBC,IAAzB,EAA+B;AAC7B,QAAIA,IAAI,CAACC,cAAT,EAAyB;AACvBC,MAAAA,2BAA2B,CAACC,eAA5B,CAA4ClB,QAAQ,CAACM,cAAT,CAAwBS,IAAI,CAACC,cAA7B,CAA5C;AACD;;AACD,WAAOD,IAAI,CAACI,KAAL,CAAWC,OAAX,CAAmBT,aAAnB,CAAiC,wBAAjC,KAA8D,IAArE;AACD;;AAED,WAASU,cAAT,CAAwBN,IAAxB,EAA8B;AAC5B,WAAOA,IAAI,CAACI,KAAL,CAAWG,OAAX,GAAqB7B,gCAArB,GAAwDC,YAA/D;AACD;;AAED,WAAS6B,cAAT,CAAwBC,EAAxB,EAA4BT,IAA5B,EAAkCU,QAAlC,EAA4C;AAC1C,QAAIJ,cAAc,CAACN,IAAD,CAAd,CAAqBW,QAArB,CAA8BF,EAAE,CAACG,OAAjC,CAAJ,EAA+C;AAC7CH,MAAAA,EAAE,CAACI,cAAH;AACD;;AACD,QAAIJ,EAAE,CAACG,OAAH,KAAevC,YAAnB,EAAiC;AAC/ByC,MAAAA,qBAAqB,CAACd,IAAD,EAAOU,QAAP,CAArB;AACD,KAFD,MAEO,IAAID,EAAE,CAACG,OAAH,KAAexC,cAAnB,EAAmC;AACxC2C,MAAAA,uBAAuB,CAACf,IAAD,EAAOU,QAAP,CAAvB;AACD,KAFM,MAEA,IACL,OAAOA,QAAQ,CAACM,YAAhB,KAAiC,UAAjC,IACA,CAAC1C,OAAD,EAAUE,SAAV,EAAqBC,SAArB,EAAgCkC,QAAhC,CAAyCF,EAAE,CAACG,OAA5C,CAFK,EAGL;AACAF,MAAAA,QAAQ,CAACM,YAAT;AACD;AACF;;AAED,WAASD,uBAAT,CAAiCf,IAAjC,EAAuCU,QAAvC,EAAiD;AAC/C,QAAMO,iBAAiB,GAAGjB,IAAI,CAACI,KAAL,CAAWc,mBAAX,GACtBlB,IAAI,CAACI,KAAL,CAAWc,mBAAX,CAA+BC,kBADT,GAEtBnB,IAAI,CAACI,KAAL,CAAWC,OAAX,CAAmBe,QAAnB,CAA4B,CAA5B,CAFJ;;AAGA,QAAIH,iBAAJ,EAAuB;AACrB,UACEA,iBAAiB,CAACI,SAAlB,IACArB,IAAI,CAACI,KAAL,CAAWC,OAAX,CAAmBiB,YAAnB,GAAkCL,iBAAiB,CAACK,YAFtD,EAGE;AACAtB,QAAAA,IAAI,CAACI,KAAL,CAAWC,OAAX,CAAmBkB,SAAnB,GACEvB,IAAI,CAACI,KAAL,CAAWC,OAAX,CAAmBkB,SAAnB,GAA+BN,iBAAiB,CAACK,YADnD;AAED;;AACDZ,MAAAA,QAAQ,CAACc,YAAT,CAAsBP,iBAAtB;AACD;AACF;;AAED,WAASH,qBAAT,CAA+Bd,IAA/B,EAAqCU,QAArC,EAA+C;AAC7C,QAAMe,iBAAiB,GAAGzB,IAAI,CAACI,KAAL,CAAWc,mBAAX,GACtBlB,IAAI,CAACI,KAAL,CAAWc,mBAAX,CAA+BQ,sBADT,GAEtB,IAFJ;;AAGA,QAAID,iBAAJ,EAAuB;AACrB,UACEA,iBAAiB,CAACJ,SAAlB,GAA8BrB,IAAI,CAACI,KAAL,CAAWC,OAAX,CAAmBiB,YAAjD,IAAiE,CAAjE,IACAtB,IAAI,CAACI,KAAL,CAAWC,OAAX,CAAmBkB,SAAnB,GAA+B,CAFjC,EAGE;AACAvB,QAAAA,IAAI,CAACI,KAAL,CAAWC,OAAX,CAAmBkB,SAAnB,GACEvB,IAAI,CAACI,KAAL,CAAWC,OAAX,CAAmBkB,SAAnB,GAA+BE,iBAAiB,CAACH,YADnD;AAED;;AACDZ,MAAAA,QAAQ,CAACc,YAAT,CAAsBC,iBAAtB;AACD;AACF;;AAED,WAASE,mBAAT,CACEC,WADF,EAEEC,UAFF,EAGEC,UAHF,EAIEd,YAJF,EAKE;AACA,aAASe,gBAAT,GAA4B;AAC1BD,MAAAA,UAAU,CAACE,gBAAX,CAA4B,UAA5B,EAAwChB,YAAxC;AACD;;AAED,aAASiB,mBAAT,GAA+B;AAC7BH,MAAAA,UAAU,CAACI,mBAAX,CAA+B,UAA/B,EAA2ClB,YAA3C;AACD;;AAED,aAASmB,WAAT,CAAqB1B,EAArB,EAAyB;AACvB,UAAIA,EAAE,CAAC2B,IAAH,KAAY,WAAZ,IAA2B3B,EAAE,CAAC2B,IAAH,KAAY,OAA3C,EAAoD;AAClDH,QAAAA,mBAAmB;AACpB,OAFD,MAEO;AACLF,QAAAA,gBAAgB;AACjB;AACF;;AAED,QAAIH,WAAJ,EAAiB;AACfG,MAAAA,gBAAgB;AACjB;;AAED9D,IAAAA,oBAAoB,CAACoE,OAArB,CAA6B,UAAUC,KAAV,EAAiB;AAC5C,UAAIV,WAAJ,EAAiB;AACfE,QAAAA,UAAU,CAACE,gBAAX,CAA4BM,KAA5B,EAAmCH,WAAnC;AACAN,QAAAA,UAAU,CAACG,gBAAX,CAA4BM,KAA5B,EAAmCH,WAAnC;AACD,OAHD,MAGO;AACLL,QAAAA,UAAU,CAACI,mBAAX,CAA+BI,KAA/B,EAAsCH,WAAtC;AACAN,QAAAA,UAAU,CAACK,mBAAX,CAA+BI,KAA/B,EAAsCH,WAAtC;AACD;AACF,KARD;AASD;;AAED,WAASI,WAAT,CAAqBxD,EAArB,EAAyBC,MAAzB,EAAiC;AAC/B,QAAMwD,UAAU,GAAGtE,iBAAiB,GAAGa,EAAvC;AACA,KAACC,MAAM,IAAIC,QAAQ,CAACW,aAAT,CAAuB,MAAvB,CAAX,EAA2C6C,WAA3C,CACExD,QAAQ,CAACM,cAAT,CAAwBiD,UAAxB,CADF;AAGA,WAAOvD,QAAQ,CAACM,cAAT,CAAwBiD,UAAxB,CAAP;AACD;;AAED,WAASE,aAAT,CAAuB3D,EAAvB,EAA2B;AACzB,QAAMsB,OAAO,GAAGpB,QAAQ,CAACM,cAAT,CAAwBrB,iBAAiB,GAAGa,EAA5C,CAAhB;;AACA,QAAIsB,OAAJ,EAAa;AACXA,MAAAA,OAAO,CAACsC,UAAR,CAAmBC,WAAnB,CAA+BvC,OAA/B;AACD;;AACD,WAAO,IAAP;AACD;;AAED,WAASF,eAAT,CAAyB0C,aAAzB,EAAwC;AACtC,QAAMC,uBAAuB,GAAGD,aAAa,CAACF,UAAd,CAAyB/C,aAAzB,CAC9B,wBAD8B,CAAhC;;AAGA,QAAIkD,uBAAJ,EAA6B;AAC3BA,MAAAA,uBAAuB,CAACjD,YAAxB,CAAqC,eAArC,EAAsD,OAAtD;AACD;;AACDgD,IAAAA,aAAa,CAAChD,YAAd,CAA2B,eAA3B,EAA4C,MAA5C;AACD;;AAED,WAASkD,WAAT,CAAqBrD,QAArB,EAA+BsD,aAA/B,EAA8C;AAC5C,QAAMC,oBAAoB,GAAGD,aAAa,CAACpD,aAAd,CAC3BzB,wBAD2B,CAA7B;AAGAuB,IAAAA,QAAQ,CAACwD,KAAT,CAAeC,QAAf,GAA0B,UAA1B;AACAzD,IAAAA,QAAQ,CAACwD,KAAT,CAAeE,MAAf,GAAwB,IAAxB;AACA1D,IAAAA,QAAQ,CAACwD,KAAT,CAAeG,KAAf,GAAuBJ,oBAAoB,CAACK,WAArB,GAAmC,IAA1D;AACA5D,IAAAA,QAAQ,CAACwD,KAAT,CAAeK,IAAf,aAAyBN,oBAAoB,CAACO,qBAArB,GAA6CD,IAA7C,GACvBE,MAAM,CAACC,WADT;AAEAhE,IAAAA,QAAQ,CAACwD,KAAT,CAAeS,GAAf,aAAwBV,oBAAoB,CAACO,qBAArB,GAA6CG,GAA7C,GACtBF,MAAM,CAACG,WADe,GAEtBX,oBAAoB,CAAC3B,YAFvB;AAGD;;AAED,WAASuC,kBAAT,CAA4BC,KAA5B,EAAmC;AACjC,QAAMxB,KAAK,GAAGrD,QAAQ,CAAC8E,WAAT,CAAqB,YAArB,CAAd;AACAzB,IAAAA,KAAK,CAAC0B,SAAN,CAAgB,QAAhB,EAA0B,IAA1B,EAAgC,KAAhC;AACAF,IAAAA,KAAK,CAACG,aAAN,CAAoB3B,KAApB;AACD;;AAED,SAAO;AACL1D,IAAAA,aAAa,EAAbA,aADK;AAELY,IAAAA,qBAAqB,EAArBA,qBAFK;AAGL+C,IAAAA,WAAW,EAAXA,WAHK;AAILZ,IAAAA,mBAAmB,EAAnBA,mBAJK;AAKLe,IAAAA,aAAa,EAAbA,aALK;AAMLK,IAAAA,WAAW,EAAXA,WANK;AAOLc,IAAAA,kBAAkB,EAAlBA,kBAPK;AAQLrD,IAAAA,cAAc,EAAdA,cARK;AASLL,IAAAA,eAAe,EAAfA,eATK;AAULJ,IAAAA,eAAe,EAAfA;AAVK,GAAP;AAYD,CAhMD;;AAiMAG,2BAA2B,GAAGpC,QAAQ,CAACC,UAAT,CAAoBC,QAApB,EAA9B","sourcesContent":["// COMPONENT - c-listbox\n\nuiCoronitaModulesValidation = {\n  init: function () {\n    return true;\n  }\n};\n\nCoronita.clientflow.cListbox = (function () {\n  const LISTBOX_MOUSE_EVENTS = ['mouseover', 'mouseout', 'focus'];\n  const LISTBOX_ID_PREFIX = 'c-listbox-';\n  const SELECTOR_LISTBOX_WRAPPER = '[data-coronita-listbox-wrapper]';\n  const KEY_ARROW_DOWN = 40;\n  const KEY_ARROW_UP = 38;\n  const KEY_ESC = 27;\n  const KEY_TAB = 9;\n  const KEY_ENTER = 13;\n  const KEY_SPACE = 32;\n  const KEYS_LISTBOX_LOCK_TAB_NAVIGATION = [\n    KEY_ARROW_UP,\n    KEY_ARROW_DOWN,\n    KEY_TAB,\n    KEY_ESC,\n    KEY_ENTER,\n    KEY_SPACE\n  ];\n  const KEYS_LISTBOX = [KEY_ARROW_UP, KEY_ARROW_DOWN];\n\n  function appendResults(templateId, results, id, target) {\n    (target || document.body).insertAdjacentHTML(\n      'beforeend',\n      _.tmpl(templateId, {\n        options: results,\n        id: id\n      })\n    );\n    return document.getElementById(`${LISTBOX_ID_PREFIX}${id}`);\n  }\n  \n  function checkActiveDescendant($parent, $listbox) {\n    const $selected = $listbox.querySelector('[aria-selected=\"true\"]');\n    if ($selected) {\n      $parent.setAttribute('aria-activedescendant', $selected.getAttribute('id'));\n    }\n  }\n\n  function getActiveOption(data) {\n    if (data.selectedOption) {\n      uiCoronitaComponentsListbox.setAriaSelected(document.getElementById(data.selectedOption));\n    }\n    return data.$refs.listbox.querySelector('[aria-selected=\"true\"]') || null;\n  }\n\n  function getListboxKeys(data) {\n    return data.$refs.cSelect ? KEYS_LISTBOX_LOCK_TAB_NAVIGATION : KEYS_LISTBOX;\n  }\n  \n  function listboxKeyDown(ev, data, callback) {\n    if (getListboxKeys(data).includes(ev.keyCode)) {\n      ev.preventDefault();\n    }\n    if (ev.keyCode === KEY_ARROW_UP) {\n      listboxKeyDownArrowUp(data, callback);\n    } else if (ev.keyCode === KEY_ARROW_DOWN) {\n      listboxKeyDownArrowDown(data, callback);\n    } else if (\n      typeof callback.closeListbox === 'function' &&\n      [KEY_ESC, KEY_ENTER, KEY_SPACE].includes(ev.keyCode)\n    ) {\n      callback.closeListbox();\n    }\n  }\n  \n  function listboxKeyDownArrowDown(data, callback) {\n    const $activeOptionNext = data.$refs.currentActiveOption\n      ? data.$refs.currentActiveOption.nextElementSibling\n      : data.$refs.listbox.children[0];\n    if ($activeOptionNext) {\n      if (\n        $activeOptionNext.offsetTop >=\n        data.$refs.listbox.offsetHeight - $activeOptionNext.offsetHeight\n      ) {\n        data.$refs.listbox.scrollTop =\n          data.$refs.listbox.scrollTop + $activeOptionNext.offsetHeight;\n      }\n      callback.selectOption($activeOptionNext);\n    }\n  }\n  \n  function listboxKeyDownArrowUp(data, callback) {\n    const $activeOptionPrev = data.$refs.currentActiveOption\n      ? data.$refs.currentActiveOption.previousElementSibling\n      : null;\n    if ($activeOptionPrev) {\n      if (\n        $activeOptionPrev.offsetTop - data.$refs.listbox.offsetHeight <= 0 &&\n        data.$refs.listbox.scrollTop > 0\n      ) {\n        data.$refs.listbox.scrollTop =\n          data.$refs.listbox.scrollTop - $activeOptionPrev.offsetHeight;\n      }\n      callback.selectOption($activeOptionPrev);\n    }\n  }\n  \n  function mouseEventsListener(\n    addListener,\n    $secondary,\n    $focusable,\n    closeListbox\n  ) {\n    function addFocusoutEvent() {\n      $focusable.addEventListener('focusout', closeListbox);\n    }\n  \n    function removeFocusoutEvent() {\n      $focusable.removeEventListener('focusout', closeListbox);\n    }\n  \n    function mouseEvents(ev) {\n      if (ev.type === 'mouseover' || ev.type === 'focus') {\n        removeFocusoutEvent();\n      } else {\n        addFocusoutEvent();\n      }\n    }\n  \n    if (addListener) {\n      addFocusoutEvent();\n    }\n  \n    LISTBOX_MOUSE_EVENTS.forEach(function (event) {\n      if (addListener) {\n        $focusable.addEventListener(event, mouseEvents);\n        $secondary.addEventListener(event, mouseEvents);\n      } else {\n        $focusable.removeEventListener(event, mouseEvents);\n        $secondary.removeEventListener(event, mouseEvents);\n      }\n    });\n  }\n  \n  function moveResults(id, target) {\n    const LISTBOX_ID = LISTBOX_ID_PREFIX + id;\n    (target || document.querySelector('body')).appendChild(\n      document.getElementById(LISTBOX_ID)\n    );\n    return document.getElementById(LISTBOX_ID);\n  }\n  \n  function removeResults(id) {\n    const listbox = document.getElementById(LISTBOX_ID_PREFIX + id);\n    if (listbox) {\n      listbox.parentNode.removeChild(listbox);\n    }\n    return null;\n  }\n\n  function setAriaSelected($activeOption) {\n    const $previousSelectedOption = $activeOption.parentNode.querySelector(\n      '[aria-selected=\"true\"]'\n    );\n    if ($previousSelectedOption) {\n      $previousSelectedOption.setAttribute('aria-selected', 'false');\n    }\n    $activeOption.setAttribute('aria-selected', 'true');\n  }\n  \n  function setPosition($listbox, $listboxOwner) {\n    const $listboxOwnerWrapper = $listboxOwner.querySelector(\n      SELECTOR_LISTBOX_WRAPPER\n    );\n    $listbox.style.position = 'absolute';\n    $listbox.style.zIndex = 9995;\n    $listbox.style.width = $listboxOwnerWrapper.offsetWidth + 'px';\n    $listbox.style.left = `${$listboxOwnerWrapper.getBoundingClientRect().left +\n      window.pageXOffset}px`;\n    $listbox.style.top = `${$listboxOwnerWrapper.getBoundingClientRect().top +\n      window.pageYOffset +\n      $listboxOwnerWrapper.offsetHeight}px`;\n  }\n  \n  function triggerInputChange(input) {\n    const event = document.createEvent('HTMLEvents');\n    event.initEvent('change', true, false);\n    input.dispatchEvent(event);\n  }\n\n  return {\n    appendResults,\n    checkActiveDescendant,\n    moveResults,\n    mouseEventsListener,\n    removeResults,\n    setPosition,\n    triggerInputChange,\n    listboxKeyDown,\n    setAriaSelected,\n    getActiveOption\n  };\n});\nuiCoronitaComponentsListbox = Coronita.clientflow.cListbox();\n"],"file":"c-listbox.js"}